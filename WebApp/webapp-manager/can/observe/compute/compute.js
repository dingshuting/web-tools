steal("can/util","can/util/bind",function(b,w){var r=function(d,a){var m;b.Observe&&(m=b.Observe.__reading,b.Observe.__reading=function(c,a){g.push({obj:c,attr:a+""})});var g=[],c=d.call(a);b.Observe&&(b.Observe.__reading=m);return{value:c,observed:g}},u=function(d,a,m,g){var c={},k=!0,e={value:void 0,teardown:function(){for(var a in c){var b=c[a];b.observe.obj.unbind(b.observe.attr,f);delete c[a]}}},l,f=function(a){if(!g||g.bound)if(void 0===a.batchNum||a.batchNum!==l){var c=e.value,b=h();e.value=
b;b!==c&&m(b,c);l=l=a.batchNum}},h=function(){var h=r(d,a),e=h.observed,h=h.value;k=!k;b.each(e,function(a){c[a.obj._cid+"|"+a.attr]?c[a.obj._cid+"|"+a.attr].matched=k:(c[a.obj._cid+"|"+a.attr]={matched:k,observe:a},a.obj.bind(a.attr,f))});for(var g in c)e=c[g],e.matched!==k&&(e.observe.obj.unbind(e.observe.attr,f),delete c[g]);return h};e.value=h();e.isListening=!b.isEmptyObject(c);return e};b.compute=function(d,a,m){if(d&&d.isComputed)return d;var g,c,k={bound:!1,hasDependencies:!1},e=function(){},
l=function(){},f,h=function(){return f},n=function(a){f=a},t=!0;c=function(d){if(arguments.length){var e=f,g=n.call(a,d,e);if(c.hasDependencies)return h.call(a);f=void 0===g?h.call(a):g;e!==f&&b.Observe.triggerBatch(c,"change",[f,e]);return f}b.Observe&&b.Observe.__reading&&t&&b.Observe.__reading(c,"change");return k.bound?f:h.call(a)};if("function"===typeof d)h=n=d,t=!1===m?!1:!0,c.hasDependencies=!1,e=function(b){g=u(d,a||this,b,k);c.hasDependencies=g.isListening;f=g.value},l=function(){g&&g.teardown()};
else if(a)if("string"==typeof a){var p=d instanceof b.Observe;p&&(c.hasDependencies=!0);var h=function(){return p?d.attr(a):d[a]},n=function(b){p?d.attr(a,b):d[a]=b},q,e=function(c){q=function(){c(h(),f)};b.bind.call(d,m||a,q);f=r(h).value},l=function(){b.unbind.call(d,m||a,q)}}else"function"===typeof a?(f=d,n=a):(f=d,h=a.get||h,n=a.set||n,e=a.on||e,l=a.off||l);else f=d;c.isComputed=!0;b.cid(c,"compute");var v=function(a,d){f=a;b.Observe.triggerBatch(c,"change",[a,d])};return b.extend(c,{_bindsetup:function(){k.bound=
!0;e.call(this,v)},_bindteardown:function(){l.call(this,v);k.bound=!1},bind:b.bindAndSetup,unbind:b.unbindAndTeardown})};b.compute.binder=u;return b.compute});